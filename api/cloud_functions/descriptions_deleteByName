exports = async function(name){
  const serviceName = "mongodb-atlas";
  const dbName = "HrDataDev";

  const db = context.services.get(serviceName).db(dbName);
  const motorsCollection = db.collection("calibMotorsDescription");
  const animationsCollection = db.collection("calibAnimationsDescription");

  let motorsDescription
  let animationsDescription
  
  // Find descriptions
  try {
    motorsDescription = await motorsCollection.findOne({name});
    animationsDescription = await animationsCollection.findOne({name});
  } catch(err) {
    console.log("Error occurred while getting descriptions:", err.message);
    return { error: err.message };
  }
  
  // Delete images
  const idsToDelete = []
  motorsDescription?.motors?.forEach((m) => {
    if (m?.neutralPosition?.images) {
      idsToDelete.push(...m.neutralPosition.images)
    }
    if (m?.maxPosition?.images) {
      idsToDelete.push(...m.maxPosition.images)
    }
    if (m?.minPosition?.images) {
      idsToDelete.push(...m.minPosition.images)
    }
  })
  animationsDescription?.animations?.forEach((a) => {
    if (a?.images) {
      idsToDelete.push(...a.images)
    }
  })
  context.functions.execute('images_deleteOld', idsToDelete, [])

  // Delete descriptions
  try {
    await motorsCollection.deleteOne({name})
    await animationsCollection.deleteOne({name})
  } catch(err) {
    console.log("Error occurred while deleting descriptions:", err.message);
    return { error: err.message };
  }
  
  return
};