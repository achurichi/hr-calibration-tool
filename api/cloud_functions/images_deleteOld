exports = async function(oldImageIds, newImageIds){
  const serviceName = "mongodb-atlas";
  const dbName = "HrDataDev";

  const db = context.services.get(serviceName).db(dbName);
  const collection = db.collection("calibImage");

  let result;

  const idsToDelete = oldImageIds.filter(oldId => !newImageIds.includes(oldId))
  
  try {
    const query = { _id: { $in: idsToDelete.map(id => new BSON.ObjectId(id)) } }
    result = await collection.deleteMany(query)
  } catch(err) {
    console.log("Error occurred while deleting images:", err.message);
    return { error: err.message };
  }

  return { result };
};